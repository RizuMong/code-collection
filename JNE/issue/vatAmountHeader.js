var data_body = [
  {
      "adjusted_insurance_admin": 0,
      "adjusted_insurance_admin_before_vat": 0,
      "adjusted_insurance_admin_dpp": 0,
      "adjusted_insurance_admin_vat": 0,
      "adjusted_insurance_premi": 0,
      "alloc_incentive_to_own_incentive": 0,
      "alloc_ops_cost_to_ho_ops_cost": 0,
      "alloc_royalty_to_ho_royalti": 0,
      "cod_amount": 0,
      "cod_fee_amount": 0,
      "cod_fee_amount_dpp": 0,
      "company_id": 230,
      "created_at": 1736766385089,
      "created_by": 1922,
      "createdby": "bcmssuv.vika@jne.co.id",
      "createddtm": "Jan  13,  2025,  18:6",
      "currency": {
          "id": "Mi9jQZi4R",
          "name": "IDR"
      },
      "dasar_pengenaan_pajak": 465000,
      "description": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15) - (Origin DPK)",
      "discount_amount_awb": 100000,
      "discount_amount_inv": 0,
      "exchange_rate": 1,
      "id": "0lWUpbDHg",
      "ids": "0lWUpbDHg",
      "ids_parent": "Jjj65xvNR",
      "ids_parent_obj": {
          "id": "Jjj65xvNR",
          "name": "CGK/GIMFEE/01/2412000279"
      },
      "import_id": "qEZUtbvNg",
      "invoice_number": "CGK/GIMFEE/01/2412000279RA",
      "invoicing_type_object": {
          "id": "cm1msDw4R",
          "name": "Group Invoice - With Management Fee NA"
      },
      "invoicing_type_text": "Group Invoice - With Management Fee NA",
      "lastupdprocess": "H1mYfKwVR - Create Form",
      "na_principal": {
          "id": "ReFNB3fVg",
          "name": "CGK"
      },
      "na_principal_text": "CGK",
      "number_sequence_invoice_header": "CGK/GIMFEE/01/2412000279",
      "origin_branch_id": "DPK",
      "origin_branch_id_obj": {
          "id": "ANpHfqf4g",
          "name": "DPK"
      },
      "original_amount": 565000,
      "original_insurance_admin": 0,
      "original_insurance_premi": 0,
      "other_charges": 0,
      "packing": 0,
      "reward": 0,
      "row": 3,
      "source_data": "qEZUtbvNg - import",
      "stamp": 0,
      "surcharge": 0,
      "total_adjusted_insurance": 0,
      "total_amount": 0,
      "total_amount_dpp": 465000,
      "total_packing_charges": 0,
      "total_paid_amount": 470115,
      "transaction_type": {
          "id": "0QEaUF6ng",
          "name": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15)"
      },
      "transaction_type_text": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15)",
      "updated_at": 1736766386032,
      "updated_by": 1922,
      "vat_amount": 5115,
      "vat_out_tarif_num_body": 1.1,
      "vat_out_tariff_from_header": {
          "id": "HFgv0pRVg",
          "name": "PPN 1.1%"
      }
  },
  {
      "adjusted_insurance_admin": 10000,
      "adjusted_insurance_admin_before_vat": 9009.01,
      "adjusted_insurance_admin_dpp": 9009.01,
      "adjusted_insurance_admin_vat": 990.99,
      "adjusted_insurance_premi": 10000,
      "alloc_incentive_to_own_incentive": 0,
      "alloc_ops_cost_to_ho_ops_cost": 0,
      "alloc_royalty_to_ho_royalti": 0,
      "cod_amount": 0,
      "cod_fee_amount": 0,
      "cod_fee_amount_dpp": 0,
      "company_id": 230,
      "created_at": 1736766385098,
      "created_by": 1922,
      "createdby": "bcmssuv.vika@jne.co.id",
      "createddtm": "Jan  13,  2025,  18:6",
      "currency": {
          "id": "Mi9jQZi4R",
          "name": "IDR"
      },
      "dasar_pengenaan_pajak": 1688520,
      "description": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15) - (Origin CGK)",
      "discount_amount_awb": 100000,
      "discount_amount_inv": 0,
      "exchange_rate": 1,
      "id": "olWUtbvHg",
      "ids": "olWUtbvHg",
      "ids_parent": "Jjj65xvNR",
      "ids_parent_obj": {
          "id": "Jjj65xvNR",
          "name": "CGK/GIMFEE/01/2412000279"
      },
      "import_id": "qEZUtbvNg",
      "invoice_number": "CGK/GIMFEE/01/2412000279RA",
      "invoicing_type_object": {
          "id": "cm1msDw4R",
          "name": "Group Invoice - With Management Fee NA"
      },
      "invoicing_type_text": "Group Invoice - With Management Fee NA",
      "lastupdprocess": "H1mYfKwVR - Create Form",
      "na_principal": {
          "id": "ReFNB3fVg",
          "name": "CGK"
      },
      "na_principal_text": "CGK",
      "number_sequence_invoice_header": "CGK/GIMFEE/01/2412000279",
      "origin_branch_id": "CGK",
      "origin_branch_id_obj": {
          "id": "ReFNB3fVg",
          "name": "CGK"
      },
      "original_amount": 1788520,
      "original_insurance_admin": 0,
      "original_insurance_premi": 0,
      "other_charges": 0,
      "packing": 0,
      "reward": 0,
      "row": 2,
      "source_data": "qEZUtbvNg - import",
      "stamp": 0,
      "surcharge": 0,
      "total_adjusted_insurance": 20000,
      "total_amount": 0,
      "total_amount_dpp": 1688520,
      "total_packing_charges": 0,
      "total_paid_amount": 1727093,
      "transaction_type": {
          "id": "0QEaUF6ng",
          "name": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15)"
      },
      "transaction_type_text": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15)",
      "updated_at": 1736766386034,
      "updated_by": 1922,
      "vat_amount": 18573,
      "vat_out_tarif_num_body": 1.1,
      "vat_out_tariff_from_header": {
          "id": "HFgv0pRVg",
          "name": "PPN 1.1%"
      }
  },
  {
      "adjusted_insurance_admin": 5000,
      "adjusted_insurance_admin_before_vat": 4504.5,
      "adjusted_insurance_admin_dpp": 4504.5,
      "adjusted_insurance_admin_vat": 495.5,
      "adjusted_insurance_premi": 5000,
      "alloc_incentive_to_own_incentive": 0,
      "alloc_ops_cost_to_ho_ops_cost": 0,
      "alloc_royalty_to_ho_royalti": 0,
      "cod_amount": 0,
      "cod_fee_amount": 0,
      "cod_fee_amount_dpp": 0,
      "company_id": 230,
      "created_at": 1736766385084,
      "created_by": 1922,
      "createdby": "bcmssuv.vika@jne.co.id",
      "createddtm": "Jan  13,  2025,  18:6",
      "currency": {
          "id": "Mi9jQZi4R",
          "name": "IDR"
      },
      "dasar_pengenaan_pajak": 3467300,
      "description": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15) - (Origin BDO)",
      "discount_amount_awb": 100000,
      "discount_amount_inv": 0,
      "exchange_rate": 1,
      "id": "plZ8tbvHg",
      "ids": "plZ8tbvHg",
      "ids_parent": "Jjj65xvNR",
      "ids_parent_obj": {
          "id": "Jjj65xvNR",
          "name": "CGK/GIMFEE/01/2412000279"
      },
      "import_id": "qEZUtbvNg",
      "invoice_number": "CGK/GIMFEE/01/2412000279RA",
      "invoicing_type_object": {
          "id": "cm1msDw4R",
          "name": "Group Invoice - With Management Fee NA"
      },
      "invoicing_type_text": "Group Invoice - With Management Fee NA",
      "lastupdprocess": "H1mYfKwVR - Create Form",
      "na_principal": {
          "id": "ReFNB3fVg",
          "name": "CGK"
      },
      "na_principal_text": "CGK",
      "number_sequence_invoice_header": "CGK/GIMFEE/01/2412000279",
      "origin_branch_id": "BDO",
      "origin_branch_id_obj": {
          "id": "pMdNf3fVR",
          "name": "BDO"
      },
      "original_amount": 3567300,
      "original_insurance_admin": 0,
      "original_insurance_premi": 0,
      "other_charges": 0,
      "packing": 0,
      "reward": 0,
      "row": 1,
      "source_data": "qEZUtbvNg - import",
      "stamp": 0,
      "surcharge": 0,
      "total_adjusted_insurance": 10000,
      "total_amount": 0,
      "total_amount_dpp": 3467300,
      "total_packing_charges": 0,
      "total_paid_amount": 3515440,
      "transaction_type": {
          "id": "0QEaUF6ng",
          "name": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15)"
      },
      "transaction_type_text": "Jasa Pengangkutan/Ekspedisi (Diluar Scope PPh 15)",
      "updated_at": 1736766386052,
      "updated_by": 1922,
      "vat_amount": 38140,
      "vat_out_tarif_num_body": 1.1,
      "vat_out_tariff_from_header": {
          "id": "HFgv0pRVg",
          "name": "PPN 1.1%"
      }
  }
]

function _log(msg) {
  console.log(msg);
}

var TotalPaidAmountHeader = 0;
var TotalAmountDPP = 0;
var TotalAmount = 0;
var TotalVATAmount = 0;
var TotalAdjusted = 0;
var TotalPackingCharges = 0;

// 30-05-2023 14.03 wib
var SumAdjustedInsuranceAdminBeforeVat = 0;
var SumAdjustedInsuranceAdminVat = 0;
var SumOriginalAmount = 0;
var SumDiscountAmountAwb = 0;
var SumAdjustedInsurancePremi = 0;

var SumAdjustedInsuranceAdmin = 0;

// penambahan baru 08-Jan-2025 -SG
var adjusted_insurance_admin_dpp = 0
var dasar_pengenaan_pajak = 0

var TotalAdjustedInsuranceAdminDpp = 0
var TotalDasarPengenaanPajak = 0




for (var i = 0; i < data_body.length; i++) {
    
    if (data_body[i].total_paid_amount != null) {
        TotalPaidAmountHeader += data_body[i].total_paid_amount;
    }

    if (data_body[i].total_amount != null) {
        TotalAmount += data_body[i].total_amount;
    }
    if (data_body[i].vat_amount != null) {
        TotalVATAmount += data_body[i].vat_amount;
        console.log(data_body[i].vat_amount);
    }
    if (data_body[i].total_adjusted_insurance != null) {
        TotalAdjusted += data_body[i].total_adjusted_insurance;
    }
    
    // add 22-05-23 08.04 add field
     if (data_body[i].total_packing_charges != null) {
        TotalPackingCharges += data_body[i].total_packing_charges;
    }

     if (data_body[i].total_amount_dpp != null) {
        TotalAmountDPP += data_body[i].total_amount_dpp;
    }
    
    // addition 30-05-2023 14.05 wib
    if (data_body[i].adjusted_insurance_admin_before_vat != null) {
        SumAdjustedInsuranceAdminBeforeVat += data_body[i].adjusted_insurance_admin_before_vat;
    }
    if (data_body[i].adjusted_insurance_admin_vat != null) {
        SumAdjustedInsuranceAdminVat += data_body[i].adjusted_insurance_admin_vat;
    }
    
     if (data_body[i].original_amount != null) {
        SumOriginalAmount += data_body[i].original_amount;
    }

      if (data_body[i].discount_amount_awb != null) {
        SumDiscountAmountAwb += data_body[i].discount_amount_awb;
    }

     if (data_body[i].adjusted_insurance_premi != null) {
        SumAdjustedInsurancePremi += data_body[i].adjusted_insurance_premi;
    }
   //end addtion 30-05-2023 15.30 wib

     // addtion [testing - 12-07-23] 13-07-23 13.41
    if (data_body[i].total_packing_charges != null) {
        SumAdjustedInsuranceAdmin += data_body[i].adjusted_insurance_admin;
    }
   
   // add 08-Jan-2025 15.07 peraturan pajak baru 2025
     if (data_body[i].adjusted_insurance_admin_dpp != null) {
        TotalAdjustedInsuranceAdminDpp += data_body[i].adjusted_insurance_admin_dpp;
    }

     if (data_body[i].dasar_pengenaan_pajak != null) {
        TotalDasarPengenaanPajak += data_body[i].dasar_pengenaan_pajak;
    }
     // end add 08-Jan-2025 15.07 peraturan pajak baru 2025
}


 // addtion [testing - 12-07-23] 13-07-23 13.41
SumRevenue = SumOriginalAmount + TotalPackingCharges 


// _log({
//     TotalPaidAmountHeader: TotalPaidAmountHeader,
//     TotalAmountDPP: TotalAmountDPP,
//     TotalAmount: TotalAmount,
//     TotalVATAmount: TotalVATAmount,
//     TotalAdjusted: TotalAdjusted,
//     TotalPackingCharges:TotalPackingCharges,
//     SumAdjustedInsuranceAdminBeforeVat :SumAdjustedInsuranceAdminBeforeVat,
//     SumAdjustedInsuranceAdminVat : SumAdjustedInsuranceAdminVat,
//     SumOriginalAmount:SumOriginalAmount,
//     SumDiscountAmountAwb:SumDiscountAmountAwb,
//     SumAdjustedInsurancePremi:SumAdjustedInsurancePremi,
//     SumRevenue:SumRevenue,
//     SumAdjustedInsuranceAdmin:SumAdjustedInsuranceAdmin,
//     //add 08-Jan-2025 15.07 peraturan pajak baru 2025 
//     TotalAdjustedInsuranceAdminDpp:TotalAdjustedInsuranceAdminDpp,
//     TotalDasarPengenaanPajak:TotalDasarPengenaanPajak
// })

//var calcStampHeader = TotalPaidAmountHeader + TotalVATAmount

var calcStampHeader = TotalAmountDPP + TotalVATAmount + TotalAdjusted

var stamp = 0
if (calcStampHeader >= 5000001) {
    stamp = 10000;
    // TotalPaidAmountHeader = TotalPaidAmountHeader + stamp
} else {
    stamp = 0
}


// CALCULATE TOTAL SUMMARY INVOICE BODY
var summary_total_paid = 0;
var floorTotalVATAmount = 0;

//summary_total_paid = TotalAmountDPP + TotalVATAmount + TotalAdjusted
// modif 01-11-2023 11.58  Kolom Total Paid Amount & VAT Amount nilainya dibuat tanpa angka dibelakang koma (Gambar terlampir)
summary_total_paid = Math.floor(TotalAmountDPP + TotalVATAmount + TotalAdjusted)
floorTotalVATAmount = TotalVATAmount

_log({ "TotalPaidAmountHeader": TotalPaidAmountHeader })
_log({ "stamp": stamp })
_log({ "summary_total_paid": summary_total_paid })
_log({"floorTotalVATAmount": floorTotalVATAmount})



var vat_out_type_vat = _hitFunction("func_get_total_paid_amount_vat_multibranch", { 'ids_parent': _field.ids });

if (vat_out_type_vat) {
    _field.summary_total_paid_amount = _field.total_amount_dpp_final + _field.vat_invoice_header + _field.stamp + _field.total_adjusted_insurance
} else {
    _field.summary_total_paid_amount = _field.total_amount_dpp_final + _field.stamp + _field.total_adjusted_insurance
}

if (_field.summary_total_paid_amount >= 5000000) {
    _field.stamp = 10000

} else {
    _field.stamp = 0

}




if (_field.confirmation == "Confirmed") {
  _fieldProperties.reward.disabled = true;

}

if (!_field.discount_amount_inv) {
  _field.discount_amount_inv = 0
}

if (!_field.reward) {
  _field.reward = 0
}

var getResponse =  _hitFunction("function_get_insurance_vat_out_tariff_active_post_change", { 'ids_parent': _field.ids });

_field.total_amount_dpp_final = _field.total_amount_dpp + _field.reward - _field.discount_amount_inv


var vat_out_type_vat = _hitFunction("func_get_total_paid_amount_vat_multibranch", { 'ids_parent': _field.ids });

if ((_field.total_amount_dpp_final + _field.total_adjusted_insurance) >= 5000000) {
  _field.stamp = 10000
} else {
  _field.stamp = 0
}

if (vat_out_type_vat) {
  _field.summary_total_paid_amount = _field.total_amount_dpp_final + _field.vat_invoice_header + _field.stamp + _field.total_adjusted_insurance
} else {
  _field.summary_total_paid_amount = _field.total_amount_dpp_final + _field.stamp + _field.total_adjusted_insurance
}
