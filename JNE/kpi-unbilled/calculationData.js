var get_report_unbilled_to_total_revenue = [
  {
    adjusted_amount: 91000,
    awb_date: 1709260955000,
    awb_number: "MKWEC00032585224",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "0itLh5BSR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 84000,
    awb_date: 1706773385000,
    awb_number: "MKWEC00029036324",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "6Kjbh5fSR",
    invoice_date: 1709226000000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1710741536000,
    awb_number: "MKWEC00035056924",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "8Cmy2cBSR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1709702767000,
    awb_number: "MKWEC00032915024",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "8V9L2cfIR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1709783542000,
    awb_number: "MKWEC00033336724",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "8lqL25fIR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1710741705000,
    awb_number: "MKWEC00035066724",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "BnWyh5BIR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 84000,
    awb_date: 1706841361000,
    awb_number: "MKWEC00029055924",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "G-qbh5fSRz",
    invoice_date: 1709226000000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 84000,
    awb_date: 1708482294000,
    awb_number: "MKWEC00031237724",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "IXBfhcBSg",
    invoice_date: 1709226000000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1710460709000,
    awb_number: "MKWEC00034076824",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "MSsPhcBSg",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1710297151000,
    awb_number: "MKWEC00033973524",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "XG1P2cfIRz",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 84000,
    awb_date: 1707793019000,
    awb_number: "MKWEC00030367024",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "XNiB25BIR",
    invoice_date: 1709226000000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 84000,
    awb_date: 1707294844000,
    awb_number: "MKWEC00029942524",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "a3P-2cBSg",
    invoice_date: 1709226000000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 84000,
    awb_date: 1708157375000,
    awb_number: "MKWEC00030915624",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "aBKB25fIR",
    invoice_date: 1709226000000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1709532501000,
    awb_number: "MKWEC00032706024",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "aQYYhcBIR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1712133823000,
    awb_number: "MKWEC00037394324",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "cbqU2cBIR",
    invoice_date: 0,
    is_unbilled: true,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Ready to be Invoiced",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1708591536000,
    awb_number: "MKWEC00031417324",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "hHUBh5fSg",
    invoice_date: 1709226000000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1711610554000,
    awb_number: "MKWEC00036535024",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "maIUh5BIR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 84000,
    awb_date: 1707188872000,
    awb_number: "MKWEC00029264924",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "nofa2cfSg",
    invoice_date: 1709226000000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1710989003000,
    awb_number: "MKWEC00035584324",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "tgpyh5fSR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 91000,
    awb_date: 1710296980000,
    awb_number: "MKWEC00033963724",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "uG1E2cfSR",
    invoice_date: 1711904400000,
    is_unbilled: false,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Invoiced, FP Approved",
    surcharge: 0,
  },
  {
    adjusted_amount: 182000,
    awb_date: 1712306238000,
    awb_number: "MKWEC00037493924",
    branch_id: "MKW",
    customer_id: "10002400",
    id_tmp_report_unbilled_to_total_revenue_ratio: "zh4w25BSR",
    invoice_date: 0,
    is_unbilled: true,
    other_charges: 0,
    packing: 0,
    parameter_report_unbilled_to_total_revenue_ratio_id: "qlaxh5BIR",
    status_connote: "Ready to be Invoiced",
    surcharge: 0,
  },
];

var get_detail_customer = {
  account_executive_name: "--",
  account_executive_nik: "--",
  account_executive_phone_number: "--",
  bank_account: "--",
  branch_id: {
    id: "oG2O-XC4g",
    name: "MKW",
  },
  branch_name: {
    id: "oG2O-XC4g",
    name: "JNE MANOKWARI",
  },
  ccrf_last_update_date_and_time_the_core: 1678962420000,
  check_box_billed_by_branch: [],
  check_box_billed_by_site: [],
  company_id: 0,
  contract_number: "--",
  contract_validity_period_from_date: null,
  contract_validity_period_to_date: null,
  costumer_status: "Active",
  created_at: 1689922928570,
  created_by: 0,
  creation_date_and_time: 1525879570000,
  currency: {
    id: "jFTxe3B4R",
    name: "IDR",
  },
  customer_id: "10002400",
  customer_name: "BINTUNI AGRO PRIMA PERKASA PT",
  customer_name_format: "BINTUNI AGRO PRIMA PERKASA PT",
  customer_name_initital: "B",
  customer_type: {
    id: "8xsM8KbVg",
    name: "CORPORATE",
  },
  department: "--",
  generate_mass_standard_invoice: ["YES"],
  id: "MKW_10002400",
  id_costumer_identity: "MKW_10002400",
  industry_type: {
    id: "TDwF8Kx4R",
    name: "LAIN-LAIN",
  },
  invoicing_method: {
    id: "4zx6ecqnR",
    name: "LOCAL INVOICE",
  },
  is_cashless: "YES",
  jenis_customer_type: {
    id: "OHnd8FbVg",
    name: "NON NA STANDAR",
  },
  local_parent_id: {
    id: "000000000",
    name: "--",
  },
  local_parent_name: {
    id: "000000000",
    name: "--",
  },
  na_principal: {
    id: "000000000",
    name: "--",
  },
  national_parent_id: {
    id: "000000000",
    name: "--",
  },
  national_parent_name: {
    id: "000000000",
    name: "--",
  },
  npwp_city: "JAKARTA",
  npwp_country: "INDONESIA",
  npwp_id: "02.596.470.1-001.000",
  npwp_kecamatan: "--",
  npwp_kelurahan: "--",
  npwp_name: "PT. BINTUNI AGRO PRIMA PERKASA",
  npwp_street:
    "JL TERUSAN ANGKASA KAV 1, B, 2, GUNUNG SAHARI SELATAN, KEMAYORAN, KOTA ADM. JAKARTA PUSAT, DKI JAKARTA, 10610",
  npwp_zip_code: "10610",
  organization_type: {
    id: "000000000",
    name: "--",
  },
  pkp_date: null,
  pkp_number: "02.596.470.1-001.000",
  site_id: {
    id: "000000000",
    name: "--",
  },
  site_name: {
    id: "000000000",
    name: "--",
  },
  term_of_payment: {
    id: "DKqz6qf4R",
    name: 14,
  },
  updated_at: 1702375285307,
  updated_by: 2959,
  vat_out_type: {
    id: "000000000",
    name: "--",
  },
};

// Convert Number
function changeNumber(total) {
  if (
      total === '0' ||
      total === '' ||
      total === null ||
      total === undefined
  ) {
      return 0;
  } else {
      return parseFloat(total);
  }
};

/* ====== Calculation Aging/Connote ====== */
/* Rumus per 26 Oktober 2023 */
function calculationTotalDPP(eachConnote) {
  return (
      changeNumber(eachConnote.adjusted_amount) +
      changeNumber(eachConnote.surcharge) +
      changeNumber(eachConnote.packing) +
      changeNumber(eachConnote.other_charges)
  );
};

function _numberToPercentage(data) {
  if (data === null || data === '' || data === undefined) {
      return '0%';
  } else {
      return data.toFixed(2).toString() + '%';
  }
}


// Calculate Unbilled to Total Revenue
// Total Connote
var outputTotalConnote = 0;
var outputTotalDPP = 0;

// Unbilled Connote
var outputTotalConnoteUnbilled = 0;
var outputTotalDPPUnbilled = 0;

// Billed Connote
var outputTotalConnoteBilled = 0;
var outputTotalDPPBilled = 0;

// Percentage
var outputUnbilledToTotalRevenueRatioConnote = 0;
var outputUnbilledToTotalRevenueRatioAmount = 0;

// Polarisasi
var outputPolarisasi = '';
var outputTarget = '';

// Actual
var outputActual = 0;
var outputActualPercentage = 0;

get_report_unbilled_to_total_revenue.forEach(function (eachConnote) {
    outputTotalConnote += 1;
    outputTotalDPP += calculationTotalDPP(eachConnote);

    // Filter Billed Connote
    if (eachConnote.is_unbilled === false) {
        outputTotalConnoteBilled += 1;
        outputTotalDPPBilled += calculationTotalDPP(eachConnote);
    }

    // Filter Unbilled Connote
    if (eachConnote.is_unbilled === true) {
        outputTotalConnoteUnbilled += 1;
        outputTotalDPPUnbilled += calculationTotalDPP(eachConnote);
    }
});

// Calculate Outside Looping
outputUnbilledToTotalRevenueRatioConnote =
    (outputTotalConnoteUnbilled / outputTotalConnote) * 100;
outputUnbilledToTotalRevenueRatioAmount =
    (outputTotalDPPUnbilled / outputTotalDPP) * 100;

// Hardcode
outputPolarisasi = 'Lower is better';
outputTarget = '10%';

console.log('Total Connote');
console.log({
    outputTotalConnote: outputTotalConnote,
    outputTotalDPP: outputTotalDPP
});

console.log('Unbilled Connote');
console.log({
    outputTotalConnoteUnbilled: outputTotalConnoteUnbilled,
    outputTotalDPPUnbilled: outputTotalDPPUnbilled
});

console.log('Billed Connote');
console.log({
    outputTotalConnoteBilled: outputTotalConnoteBilled,
    outputTotalDPPBilled: outputTotalDPPBilled
});

console.log('Percentage');
console.log({
    outputUnbilledToTotalRevenueRatioConnote:
        outputUnbilledToTotalRevenueRatioConnote,
    outputUnbilledToTotalRevenueRatioAmount:
        outputUnbilledToTotalRevenueRatioAmount
});

console.log('Actual');
console.log({
    outputActual: outputActual,
    outputActualPercentage: outputActualPercentage
});

console.log("Achievment");
var unbilled_to_total_revenue_ratio_amount = _numberToPercentage(outputUnbilledToTotalRevenueRatioAmount);
var targetNumber = parseFloat(outputTarget) / 100;
var ratioNumber = parseFloat(unbilled_to_total_revenue_ratio_amount) / 100;

// % Achievement
var outputachievement = (targetNumber / ratioNumber) * 100;
outputachievement = outputachievement.toFixed(2) + '%';

console.log(outputachievement);


/* Create Record Dataset Report */
var recordDataset = [
    {
        // Data Customer
        branch_id: get_detail_customer.branch_id.name,
        branch_name: get_detail_customer.branch_name.name,
        customer_type: get_detail_customer.customer_type.name,
        national_parent_id: get_detail_customer.national_parent_id.name,
        national_parent_name: get_detail_customer.national_parent_name.name,
        local_parent_id: get_detail_customer.local_parent_id.name,
        local_parent_name: get_detail_customer.local_parent_name.name,
        customer_id: get_detail_customer.customer_id,
        customer_name: get_detail_customer.customer_name,

        // Total Connote
        total_all_connote: outputTotalConnote,
        total_all_dpp: outputTotalDPP,

        // Unbilled Connote
        total_unbilled_connote: outputTotalConnoteUnbilled,
        total_unbilled_dpp: outputTotalDPPUnbilled,

        // Billed Connote
        total_billed_connote: outputTotalConnoteBilled,
        total_billed_dpp: outputTotalDPPBilled,

        // Percentage
        unbilled_to_total_revenue_ratio_connote:
            outputUnbilledToTotalRevenueRatioConnote,
        unbilled_to_total_revenue_ratio_amount:
            outputUnbilledToTotalRevenueRatioAmount,

        // Polarisasi
        polarisasi: outputPolarisasi,
        target: outputTarget,

        // Actual
        actual: outputActual,
        actual_percentage: outputActualPercentage,

        // % Achievment
        achievement: outputachievement,

        // Parent
        // parameter_unbilled_to_total_revenue_ratio_id: payload.id_parent
    }
];

console.log({
    recordDataset: recordDataset
});