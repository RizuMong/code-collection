var payload = {
  "body": {
      "additional_fields": [
        {
          "id": 12234035,
          "name": "no__hp",
          "value": null,
          "value_name": null
      },
      {
          "id": 13473277,
          "name": "location",
          "value": null,
          "value_name": null
      },
      {
          "id": 13473278,
          "name": "destination",
          "value": null,
          "value_name": null
      },
      {
          "id": 13567999,
          "name": "email_dealer",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562284,
          "name": "customer_public_id",
          "value": null,
          "value_name": null
      },
      {
          "id": 14171324,
          "name": "nama",
          "value": null,
          "value_name": null
      },
      {
          "id": 13806663,
          "name": "temporary_customer_id",
          "value": null,
          "value_name": null
      },
      {
          "id": 13560722,
          "name": "vin",
          "value": "X3JHT14561271FR02",
          "value_name": "X3JHT14561271FR02"
      },
      {
          "id": 14181086,
          "name": "plate_no",
          "value": null,
          "value_name": null
      },
      {
          "id": 14171238,
          "name": "service_date",
          "value": null,
          "value_name": null
      },
      {
          "id": 14168845,
          "name": "ldms_wo_id",
          "value": null,
          "value_name": null
      },
      {
          "id": 13561419,
          "name": "variant",
          "value": null,
          "value_name": null
      },
      {
          "id": 14181431,
          "name": "description",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562529,
          "name": "ldms_customer_id",
          "value": "23-CP-0000048",
          "value_name": "23-CP-0000048"
      },
      {
          "id": 14171237,
          "name": "service_type",
          "value": "4070778",
          "value_name": "Regular Check (RC)"
      },
      {
          "id": 13560634,
          "name": "phone_number",
          "value": "k5iFW0IKFzre",
          "value_name": "k5iFW0IKFzre"
      },
      {
          "id": 13560721,
          "name": "domisili",
          "value": null,
          "value_name": null
      },
      {
          "id": 13473449,
          "name": "complaint_type__sales",
          "value": null,
          "value_name": null
      },
      {
          "id": 13560808,
          "name": "subject_type",
          "value": "3837138",
          "value_name": "Sales"
      },
      {
          "id": 13561075,
          "name": "category",
          "value": "3837206",
          "value_name": "Question"
      },
      {
          "id": 13561331,
          "name": "category_complaint",
          "value": null,
          "value_name": null
      },
      {
          "id": 13561332,
          "name": "sub_category",
          "value": "3837277",
          "value_name": "Question"
      },
      {
          "id": 13561422,
          "name": "customer_source",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562019,
          "name": "channel",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562105,
          "name": "urgency_level",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562193,
          "name": "interaction_type",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562194,
          "name": "interface_ticket_qontak",
          "value": "3837580",
          "value_name": "True"
      },
      {
          "id": 13562300,
          "name": "status_dealer_service",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562374,
          "name": "status_lmcs",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562375,
          "name": "schedule",
          "value": "2024-09-12T00:10:00",
          "value_name": "2024-09-12T00:10:00"
      },
      {
          "id": 13562462,
          "name": "concierge_key",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562463,
          "name": "message",
          "value": "",
          "value_name": ""
      },
      {
          "id": 13562464,
          "name": "l_reach_location",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562479,
          "name": "coordinate",
          "value": null,
          "value_name": null
      },
      {
          "id": 13562723,
          "name": "url_l_reach",
          "value": "https://cms.lexus.neo-fusion.com/ServiceWorkshopRequest/409",
          "value_name": "https://cms.lexus.neo-fusion.com/ServiceWorkshopRequest/409"
      },
      {
          "id": 13562724,
          "name": "dealer_booking_service_id",
          "value": "",
          "value_name": ""
      },
      {
          "id": 13562725,
          "name": "lmcs_id",
          "value": null,
          "value_name": null
      },
      {
          "id": 13616060,
          "name": "dealer_req_key",
          "value": null,
          "value_name": null
      },
      {
          "id": 13616061,
          "name": "dealer_name",
          "value": "LEXUS MAMPANG GALLERY",
          "value_name": "LEXUS MAMPANG GALLERY"
      },
      {
          "id": 13616062,
          "name": "food_beverages",
          "value": "[]",
          "value_name": "[]"
      },
      {
          "id": 13669344,
          "name": "service_type_l_reach",
          "value": null,
          "value_name": null
      },
      {
          "id": 14184596,
          "name": "mtoyota_phone_number",
          "value": null,
          "value_name": null
      },
      {
          "id": 14184597,
          "name": "cc_phone_number",
          "value": null,
          "value_name": null
      },
      {
          "id": 14184598,
          "name": "cc_subscription_id",
          "value": null,
          "value_name": null
      },
      {
          "id": 14428309,
          "name": "dealer_code",
          "value": null,
          "value_name": null
      },
      {
          "id": 14436972,
          "name": "status_ticket_qontak",
          "value": null,
          "value_name": null
      },
      {
          "id": 14439961,
          "name": "ldms_vehicle_id",
          "value": null,
          "value_name": null
      },
      {
          "id": 14451134,
          "name": "is_from_lexus_reach",
          "value": null,
          "value_name": null
      },
      {
          "id": 14451135,
          "name": "is_telematics_emergency",
          "value": null,
          "value_name": null
      },
      {
          "id": 14451232,
          "name": "is_telematics_renewal",
          "value": null,
          "value_name": null
      },
      {
          "id": 14451329,
          "name": "is_telematics_disconnected",
          "value": null,
          "value_name": null
      },
      {
          "id": 14536533,
          "name": "remarks",
          "value": "test 1",
          "value_name": "test 1"
      },
      {
          "id": 14557520,
          "name": "call_center_telematics_url",
          "value": null,
          "value_name": null
      },
      {
          "id": 14589501,
          "name": "ldms_reservation_id",
          "value": "12345",
          "value_name": "12345"
      }
      ],
      "channel_integration_room_id": null,
      "closed_date": null,
      "created_at": "2024-09-11T10:06:06.883+07:00",
      "creator_id": 185776,
      "creator_name": "Rizky Pambudi -",
      "crm_company_id": null,
      "crm_company_name": null,
      "crm_lead_ids": [],
      "crm_lead_name": [],
      "crm_lost_reason_id": null,
      "crm_lost_reason_name": null,
      "crm_pipeline_id": 151841,
      "crm_pipeline_name": "e-Care Preventive",
      "crm_priority_id": null,
      "crm_priority_name": null,
      "crm_source_id": null,
      "crm_source_name": null,
      "crm_stage_id": 914375,
      "crm_stage_name": "Scheduled",
      "currency": "IDR",
      "expired_date": null,
      "external_company_id": 836993,
      "id": 55729027,
      "name": "(1) Mick Schumacher",
      "product_association_ids": [],
      "product_association_name": [],
      "product_association_price": [],
      "product_association_quantity": [],
      "product_association_total_price": [],
      "size": "0.0",
      "slug": "9b0eef4c-6768-4369-a678-4f0af18f6379",
      "start_date": null,
      "updated_at": "2024-09-11T10:32:11.082+07:00"
  }}

  function convertToISODate(schedule) {
    if (!isNaN(Date.parse(schedule))) {
        return schedule;
    }

    var parts = schedule.split("/");
    if (parts.length === 3) {
        // day, month, year
        var day = parts[0];
        var month = parts[1];
        var year = parts[2];
        var isoDate = year + "-" + month + "-" + day;
        return new Date(isoDate).toISOString();
    };
};

var statusMapping = {
    "1. Menteng": 1,
    "2. Mampang": 2,
    "3. Pluit": 3,
    "4. Other": 3,
};

var payloadAPI = {
    unique_ticket_id: payload.body.id
};

payload.body.additional_fields.forEach(function (item) {
  if (item.name == "schedule" && item.value != null) {
      payloadAPI.schedule = convertToISODate(item.value);
  };

  if (item.name == "ldms_wo_id" && item.value != null && item.value !== "") {
      payloadAPI.ldms_wo_id = item.value;
  };

  if (item.name == "ldms_reservation_id" && item.value != null && item.value !== "") {
      payloadAPI.ldms_reservation_id = item.value;
  };

  if (item.name == "dealer_code" && item.value != null) {
      if (statusMapping.hasOwnProperty(item.value_name)) {
          payloadAPI.dealer_code = statusMapping[item.value_name];
      }
  }
});

console.log(payloadAPI);