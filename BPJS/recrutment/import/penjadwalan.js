var req = {
  company_id: 27414,
  created_at: 1748247252991,
  created_by: 187474,
  id: "b6c8bHfNg",
  id_import: "b6c8bHfNg",
  import_id: "_qcUxNfNg",
  link: "www.asdasdsa.com",
  nama_jadwal: "Wawancara Psikologis",
  nomor_registrasi: "kAaaHq8Y6irbK44W/aNaNaN/P/REGULAR//190525",
  tanggal_mulai: "28/05/2025",
  tanggal_selesai: "28/05/2025",
  tipe_jadwal: "Interview User",
  updated_at: 1748247252991,
  updated_by: 187474,
  waktu_mulai: "22:20",
  waktu_selesai: "23:00",
};

var findTipeJadwal = [
  {
    color: "purple",
    company_id: 27414,
    created_at: 1745161326613,
    created_by: 178566,
    description: "",
    id: "hfqs8oi9SEnkBiQs",
    id_schedule_type: "hfqs8oi9SEnkBiQs",
    name: "Interview User",
    updated_at: 1745161326613,
    updated_by: 178566,
  },
];

var findKodeRegistrasi = [
  {
    agama: "Kristen",
    alamat_domisili: "Bekasi",
    alamat_ktp: "Bekasi",
    applied_job_position: "Solution Quality Assurance",
    bahasa_1: "Inggris",
    berat_badan: 70,
    bidang_perusahaan_pengalaman_1: "a",
    bidang_perusahaan_pengalaman_2: "asdad",
    bulan_akhir_perusahaan_1: "Oktober",
    bulan_akhir_perusahaan_2: "September",
    bulan_awal_perusahaan_1: "Agustus",
    bulan_awal_perusahaan_2: "Februari",
    company_id: 27414,
    created_at: 1747640652827,
    created_by: 0,
    email: "screamyd19@gmail.com",
    email_blast_count: 0,
    email_blast_reason: " ",
    email_send_status: "MENUNGGU",
    email_status_note: " ",
    file_cv:
      "https://officeless-bpjs-prod-public.oss-ap-southeast-5.aliyuncs.com/27414/682ae14f489f2-document-pdf-companyID-27414-userCompanyID-187453-mtc0nzy0mdy1ndi3oq%3D%3Dde750402e6e33e80eb82a7df4247aad9-1747640654291.pdf",
    file_sertifikasi_1: "",
    file_sertifikasi_2: "",
    first_name: "Xierra",
    gaji_terakhir_perusahaan_1: 7000000,
    gaji_terakhir_perusahaan_2: 13000000,
    handphone_1: "87851327750",
    handphone_2: "87851327750",
    id: "kAaaHq8Y6irbK44W/aNaNaN/P/REGULAR//190525",
    instansi_ayah: "a",
    instansi_ibu: "-",
    is_difabel: "false",
    jabatan_akhir_perusahaan_1: "a",
    jabatan_akhir_perusahaan_2: "QA2",
    jabatan_awal_perusahaan_1: "1a",
    jabatan_awal_perusahaan_2: "QA1",
    jenis_kelamin: "Laki-laki",
    jenis_kelamin_kerabat_1: "",
    jenis_kelamin_kerabat_2: "",
    jenis_kelamin_kerabat_3: "",
    jenis_kelamin_saudara_1: "",
    jenis_kelamin_saudara_2: "",
    jenis_kelamin_saudara_3: "",
    jenis_perusahaan_pengalaman_1: "PT",
    jenis_perusahaan_pengalaman_2: "PO",
    job_title_kerabat_2: "",
    jumlah_kantor_cabang_perusahaan_1: 1,
    jumlah_kantor_cabang_perusahaan_2: 13,
    jumlah_karyawan_perusahaan_1: 1,
    jumlah_karyawan_perusahaan_2: 13,
    kabupaten_domisili: "BEKASI",
    kabupaten_ktp: "BEKASI",
    kode_registrasi: "kAaaHq8Y6irbK44W/aNaNaN/P/REGULAR//190525",
    kodepos_domisili: "17133",
    kodepos_ktp: "17133",
    last_name: "Game",
    nama_ayah: "a",
    nama_ibu: "a",
    nama_kerabat_1: "",
    nama_kerabat_2: "",
    nama_kerabat_3: "",
    nama_lengkap: "Xierra Game",
    nik: "1305019384908731",
    nilai_toefl_ielts: -1,
    no_kk: "123",
    pekerjaan_ayah: "a",
    pekerjaan_ibu: "a",
    period_id: {
      id: "XnDrntk8OCaAbukv",
      name: "Rekrutmen Mei 2025",
    },
    period_id_text: "XnDrntk8OCaAbukv",
    pernah_toefl_ielts: "Ya, saya pernah ikut TOEFL",
    perusahaan_pengalaman_1: "a",
    perusahaan_pengalaman_2: "asd",
    photo_full_body:
      "https://officeless-bpjs-prod-public.oss-ap-southeast-5.aliyuncs.com/27414/682ac3fbea35f-Pi7_Tool_foto-dummy.jpg",
    photo_half_body:
      "https://officeless-bpjs-prod-public.oss-ap-southeast-5.aliyuncs.com/27414/682ac3fbea673-Pi7_Tool_foto-dummy.jpg",
    photo_profile:
      "https://officeless-bpjs-prod-public.oss-ap-southeast-5.aliyuncs.com/27414/682ac43566844-dummy.pdf",
    pipeline_id: {
      id: "wG0RyjItlnNzfIDZ",
      name: "DEFAULT",
    },
    provinsi_domisili: "JAWA BARAT",
    provinsi_ktp: "JAWA BARAT",
    punya_kerabat_bpjs:
      "Tidak, saya tidak memiliki keluarga di BPJS Ketenagakerjaan",
    rejected_reason: "ok bgt",
    rejected_stage_id: {},
    stage_detail: [
      {
        feedback: "bagus bgt leo",
        result_id: {
          id: "ize5o3qVKTUGDLWu",
          name: "LOLOS",
        },
        score: "100",
        stage_id: {
          id: "lNRfnl0PLxI3iYk8",
          name: "⁠Seleksi Administrasi",
        },
      },
      {
        feedback: "bagus bgt leo",
        result_id: {
          id: "ize5o3qVKTUGDLWu",
          name: "LOLOS",
        },
        score: "100",
        stage_id: {
          id: "8gI0c68tzb78RgxI",
          name: "⁠Seleksi Online",
        },
      },
      {
        feedback: "ok bgt",
        result_id: {
          id: "ize5o3qVKTUGDLWu",
          name: "LOLOS",
        },
        score: "70",
        stage_id: {
          id: "hfqAaFYRMMdbBbjw",
          name: "Diterima",
        },
      },
    ],
    stage_id: {
      id: "8gI0c68tzb78RgxI",
      name: "⁠Seleksi Online",
    },
    stage_id_text: "8gI0c68tzb78RgxI",
    status_kawin: "Lajang",
    tahun_akhir_organisasi_1: 0,
    tahun_akhir_organisasi_2: 0,
    tahun_akhir_perusahaan_1: 2010,
    tahun_akhir_perusahaan_2: 2010,
    tahun_awal_organisasi_1: 0,
    tahun_awal_organisasi_2: 0,
    tahun_awal_perusahaan_1: 2011,
    tahun_awal_perusahaan_2: 2024,
    tahun_pelatihan_1: "0",
    tahun_pelatihan_2: "0",
    tanggal_lahir: 1049907600000,
    tanggal_lahir_ayah: 1747612800000,
    tanggal_lahir_ibu: 1747612800000,
    telepon: "87851327750",
    tempat_lahir: "Jakarta",
    tinggi_badan: 170,
    tingkat_lisan_bahasa_1: "Sangat Baik",
    tingkat_membaca_bahasa_1: "Sedang",
    tingkat_mendengar_bahasa_1: "Baik",
    tingkat_menulis_bahasa_1: "Baik",
    unit_kerja_kerabat_1: "",
    unit_kerja_kerabat_2: "",
    unit_kerja_kerabat_3: "",
    updated_at: 1748241484202,
    updated_by: 181238,
    uraian_jabatan_perusahaan_1: "asda",
    uraian_jabatan_perusahaan_2: "a",
    user_data_id_text: "kAaaHq8Y6irbK44W",
    user_id_text: "UK44eZQPykSsLXiF",
    vacancy_id: "Fp70JxZjRc7VG25r",
    vacancy_reference: "Instagram",
  },
];

var getScheduleExist = [];

var body = req;
var errors = [];

if (findKodeRegistrasi.length === 0) {
  errors.push("Kode Registrasi tidak ditemukan di dalam database");
}

// === AUTO TRIM ===
for (var key in body) {
  if (typeof body[key] === "string" && body[key].trim) {
    body[key] = body[key].trim();
  }
}

// === FIELD WAJIB ===
var mandatoryFields = [
  { key: "nomor_registrasi", label: "Nomor Registrasi" },
  { key: "tipe_jadwal", label: "Tipe Jadwal" },
  { key: "tanggal_mulai", label: "Tanggal Mulai" },
  { key: "waktu_mulai", label: "Waktu Mulai" },
  { key: "tanggal_selesai", label: "Tanggal Selesai" },
  { key: "waktu_selesai", label: "Waktu Selesai" },
  { key: "nama_jadwal", label: "Nama Jadwal" },
  { key: "link", label: "Link" },
];

mandatoryFields.forEach(function (field) {
  if (!body[field.key]) {
    errors.push(field.label + " wajib diisi");
  }
});

function convertToTimestampWithTime(
  dateField,
  timeField,
  labelDate,
  labelTime
) {
  var dateValue = body[dateField];
  var timeValue = body[timeField];

  if (dateValue && timeValue) {
    var isValidDateFormat = /^\d{2}\/\d{2}\/\d{4}$/.test(dateValue);
    var isValidTimeFormat = /^\d{2}:\d{2}$/.test(timeValue);

    if (!isValidDateFormat) {
      errors.push("Format " + labelDate + " harus DD/MM/YYYY");
    }
    if (!isValidTimeFormat) {
      errors.push("Format " + labelTime + " harus HH:MM");
    }

    if (isValidDateFormat && isValidTimeFormat) {
      var dateParts = dateValue.split("/");
      var formattedDate =
        dateParts[2] + "-" + dateParts[1] + "-" + dateParts[0]; // YYYY-MM-DD
      var timestamp = new Date(
        formattedDate + "T" + timeValue + ":00"
      ).getTime();
      return timestamp;
    }
  }
  return null;
}

var tsMulai = convertToTimestampWithTime(
  "tanggal_mulai",
  "waktu_mulai",
  "Tanggal Mulai",
  "Waktu Mulai"
);
var tsSelesai = convertToTimestampWithTime(
  "tanggal_selesai",
  "waktu_selesai",
  "Tanggal Selesai",
  "Waktu Selesai"
);

if (!tsMulai) {
  errors.push("Perhatikan kembali Tanggal dan Waktu Mulai yang diinput");
}

if (!tsSelesai) {
  errors.push("Perhatikan kembali Tanggal dan Waktu Selesai yang diinput");
}

if (tsMulai && tsSelesai && tsSelesai < tsMulai) {
  errors.push(
    "Tanggal dan Waktu Selesai tidak boleh lebih awal dari Tanggal dan Waktu Mulai"
  );
}

// === VALIDASI FIND TIPE JADWAL ===
if (!findTipeJadwal || !findTipeJadwal[0] || findTipeJadwal[0].length <= 0) {
  errors.push("Tipe Jadwal tidak ditemukan");
}

if (getScheduleExist.length > 0) {
  errors.push("Penjadwalan karyawan sudah ada");
}

// === REGEX VALIDATION ===
var regexRules = [
  {
    key: "nama_jadwal",
    label: "Nama Jadwal",
    regex: /^[a-zA-Z0-9\s]+$/,
    message: "hanya boleh berisi huruf, angka, dan spasi",
  },
  // {
  //     key: "tipe_jadwal",
  //     label: "Tipe Jadwal",
  //     regex: /^[a-zA-Z0-9\s]+$/,
  //     message: "hanya boleh berisi huruf, angka, dan spasi."
  // },
  // {
  //     key: "link",
  //     label: "Link",
  //     regex: /^(http|https):\/\/[^\s$.?#].[^\s]*$/,
  //     message: "Link tidak valid."
  // }
];

regexRules.forEach(function (rule) {
  var val = body[rule.key];
  if (val && !rule.regex.test(val)) {
    errors.push(rule.label + " " + rule.message);
  }
});

var status = "";
var keterangan = "";

// === OUTPUT ===
if (errors.length > 0) {
  status = "Failed";
  keterangan = errors.join(", ") + ".";
} else {
  status = "Success";
};

console.log(errors);
console.log(keterangan);
console.log({
  tsMulai: tsMulai,
  tsSelesai: tsSelesai,
});