// Declare data
var getDataRedaksi = {
  company_id: 27414,
  created_at: 1744775309302,
  created_by: 178566,
  data_mapping: [
    {
      data: {
        id: "rvpwl0xRxkhpCnKz",
        name: "TAG_NAMA_LENGKAP",
      },
    },
  ],
  id: "N2HGLP5X3fXYzsHc",
  id_redaction: "N2HGLP5X3fXYzsHc",
  kode: "16",
  konten:
    '<!DOCTYPE html>\r\n<html lang="en">\r\n\r\n<head>\r\n\t<meta charset="UTF-8">\r\n\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\r\n\t<title>Aktivasi Email Pendaftaran Rekrutmen dan Seleksi BPJS Ketenagakerjaan</title>\r\n</head>\r\n\r\n<body>\r\n\t<table style="width: 100%" border="0">\r\n\t\t<tbody>\r\n\t\t\t<tr>\r\n\t\t\t\t<td style="width: 50%" align="left" valign="middle">\r\n\t\t\t\t\t<!--<p><span style="color: #000000; font-size: x-large;"><strong><img src="https://rekrutmen.bpjsketenagakerjaan.go.id/assets/images/logo_bpjs.png" alt="" width="350" height="80" /></strong></span></p>-->\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\t<span style="color: #000000; font-size: x-large"><strong\r\n                ><img\r\n                  src="https://d3br8pewlizote.cloudfront.net/rekrutmen/logo-bpjamsostek-color.d93616d.jpg"\r\n                  alt=""\r\n                  width="350"\r\n                  height="80" /></strong\r\n            ></span>\r\n\t\t\t\t\t</p>\r\n\t\t\t\t</td>\r\n\t\t\t\t<!--<td style="width: 50%;" align="right" valign="middle"><img src="https://rekrutmen.bpjsketenagakerjaan.go.id/assets/images/logo_rekrutmen2.png" alt="" width="350" height="75" /><br /></td>-->\r\n\t\t\t\t<td style="width: 50%" align="right" valign="middle">\r\n\t\t\t\t\t<img src="https://d3br8pewlizote.cloudfront.net/rekrutmen/logo.6f682774.png" alt="" width="350" height="75" /><br />\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</tbody>\r\n\t</table>\r\n\t<hr />\r\n\t<p>&nbsp;</p>\r\n\t<p>\r\n\t\t<strong>Kepada Yth. TAG_NAMA_LENGKAP</strong>,<br /><br />Terimakasih atas partisipasi anda.<br /><br />Silahkan klik link\r\n\t\tdi bawah ini untuk mengisi data\r\n\t</p>\r\n\r\n</body>\r\n\r\n</html>',
  pipeline_id: {
    id: "wG0RyjItlnNzfIDZ",
    name: "DEFAULT",
  },
  subject_email:
    "Aktivasi Email Pendaftaran Rekrutmen dan Seleksi BPJS Ketenagakerjaan",
  tahapan_rekrutmen_id: {
    id: "8gI0c68tzb78RgxI",
    name: "‚Å†Seleksi Online",
  },
  updated_at: 1746363702033,
  updated_by: 178566,
};

var dataApplicant = {
  agama: "",
  akreditasi_pendidikan_1: "",
  akreditasi_pendidikan_2: "",
  alamat_domisili: "",
  alamat_institusi_pendidikan_1: "",
  alamat_institusi_pendidikan_2: "",
  alamat_ktp: "",
  alamat_lembaga_pelatihan_1: "",
  alamat_lembaga_pelatihan_2: "",
  applied_job_position: "Solution Engineer",
  bahasa_1: "",
  bahasa_2: "",
  berat_badan: 0,
  bidang_organisasi_1: "",
  bidang_organisasi_2: "",
  bidang_pelatihan_1: "",
  bidang_pelatihan_2: "",
  bidang_perusahaan_pengalaman_1: "",
  bidang_perusahaan_pengalaman_2: "",
  bulan_akhir_organisasi_1: "",
  bulan_akhir_organisasi_2: "",
  bulan_akhir_perusahaan_1: "",
  bulan_akhir_perusahaan_2: "",
  bulan_awal_organisasi_1: "",
  bulan_awal_organisasi_2: "",
  bulan_awal_perusahaan_1: "",
  bulan_awal_perusahaan_2: "",
  company_id: 27414,
  created_at: 0,
  created_by: 178566,
  email: "rizki.haddi@mekari.com",
  email_send_status: "MENUNGGU",
  fakultas_pendidikan_1: "",
  fakultas_pendidikan_2: "",
  file_cv:
    "https://lms-prod-public-bucket.s3.ap-southeast-3.amazonaws.com/25257/6816173bc528b-document-pdf-companyID-25257-userCompanyID-175332-mtc0nji3odiwmjazoq%3D%3D8af30812a0b70189fb7b58fe1f2f4bc4-1746278202055.pdf",
  file_ijazah_pendidikan_terakhir: "",
  file_sertifikasi_1: "",
  file_sertifikasi_2: "",
  first_name: "",
  flow_status: "",
  gaji_terakhir_perusahaan_1: 0,
  gaji_terakhir_perusahaan_2: 0,
  handphone_1: "",
  handphone_2: "",
  hubungan_kerabat_1: "",
  hubungan_kerabat_2: "",
  hubungan_kerabat_3: "",
  id: "123",
  instansi_ayah: "",
  instansi_ibu: "",
  instansi_saudara_1: "",
  instansi_saudara_2: "",
  instansi_saudara_3: "",
  institusi_pendidikan_1: "",
  institusi_pendidikan_2: "",
  ipk_pendidikan_1: "",
  ipk_pendidikan_2: "",
  jabatan_akhir_perusahaan_1: "",
  jabatan_akhir_perusahaan_2: "",
  jabatan_awal_perusahaan_1: "",
  jabatan_awal_perusahaan_2: "",
  jabatan_organisasi_1: "",
  jabatan_organisasi_2: "",
  jenis_kelamin: "",
  jenis_kelamin_kerabat_1: "",
  jenis_kelamin_kerabat_2: "",
  jenis_kelamin_kerabat_3: "",
  jenis_kelamin_saudara_1: "",
  jenis_kelamin_saudara_2: "",
  jenis_kelamin_saudara_3: "",
  jenis_perusahaan_pengalaman_1: "",
  jenis_perusahaan_pengalaman_2: "",
  jenjang_pendidikan_1: "",
  jenjang_pendidikan_2: "",
  job_titkle_kerabat_1: "",
  job_titkle_kerabat_3: "",
  job_title_kerabat_2: "",
  jumlah_kantor_cabang_perusahaan_1: 0,
  jumlah_kantor_cabang_perusahaan_2: 0,
  jumlah_karyawan_perusahaan_1: 0,
  jumlah_karyawan_perusahaan_2: 0,
  jurusan_pendidikan_1: "",
  jurusan_pendidikan_2: "",
  kabupaten_domisili: "",
  kabupaten_institusi_pendidikan_1: "",
  kabupaten_institusi_pendidikan_2: "",
  kabupaten_ktp: "",
  kabupaten_lembaga_pelatihan_1: "",
  kabupaten_lembaga_pelatihan_2: "",
  kode_registrasi: "123",
  kodepos_domisili: "",
  kodepos_institusi_pendidikan_1: "",
  kodepos_institusi_pendidikan_2: "",
  kodepos_ktp: "",
  kodepos_lembaga_pelatihan_1: "",
  kodepos_lembaga_pelatihan_2: "",
  ktp_valid_until: 0,
  last_name: "",
  lembaga_pelatihan_1: "",
  lembaga_pelatihan_2: "",
  nama_ayah: "",
  nama_ibu: "",
  nama_kerabat_1: "",
  nama_kerabat_2: "",
  nama_kerabat_3: "",
  nama_lengkap: "Rizki Haddi Prayoga",
  nama_organisasi_1: "",
  nama_organisasi_2: "",
  nama_pelatihan_1: "",
  nama_pelatihan_2: "",
  nama_saudara_1: "",
  nama_saudara_2: "",
  nama_saudara_3: "",
  nik: "3001245454577787",
  no_ijazah_pendidikan_1: "",
  no_ijazah_pendidikan_2: "",
  no_kk: "",
  pekerjaan_ayah: "",
  pekerjaan_ibu: "",
  pekerjaan_saudara_1: "",
  pekerjaan_saudara_2: "",
  pekerjaan_saudara_3: "",
  period_id: {
    id: "XnDrntk8OCaAbukv",
    name: "Rekrutmen Mei 2025",
  },
  period_id_text: "XnDrntk8OCaAbukv",
  pernah_toefl_ielts: "",
  perusahaan_pengalaman_1: "",
  perusahaan_pengalaman_2: "",
  photo_full_body: "",
  photo_half_body: "",
  photo_profile: "",
  pipeline_id: {
    id: "",
    name: "",
  },
  provinsi_domisili: "",
  provinsi_institusi_pendidikan_1: "",
  provinsi_institusi_pendidikan_2: "",
  provinsi_ktp: "",
  provinsi_lembaga_pelatihan_1: "",
  provinsi_lembaga_pelatihan_2: "",
  punya_kerabat_bpjs: "",
  rejected_reason: "",
  rejected_stage_id: {
    id: "",
    name: "",
  },
  stage_detail: null,
  stage_id: {
    id: "8gI0c68tzb78RgxI",
    name: "Seleksi Online",
  },
  stage_id_text: "8gI0c68tzb78RgxI",
  status_kawin: "",
  status_lulus_pendidikan_1: "",
  status_lulus_pendidikan_2: "",
  tahun_akhir_organisasi_1: 0,
  tahun_akhir_organisasi_2: 0,
  tahun_akhir_perusahaan_1: 0,
  tahun_akhir_perusahaan_2: 0,
  tahun_awal_organisasi_1: 0,
  tahun_awal_organisasi_2: 0,
  tahun_awal_perusahaan_1: 0,
  tahun_awal_perusahaan_2: 0,
  tahun_mulai_pendidikan_1: 0,
  tahun_mulai_pendidikan_2: 0,
  tahun_pelatihan_1: "",
  tahun_pelatihan_2: "",
  tahun_selesai_pendidikan_1: 0,
  tahun_selesai_pendidikan_2: 0,
  tanggal_lahir: 0,
  tanggal_lahir_ayah: 0,
  tanggal_lahir_ibu: 0,
  tanggal_lahir_saudara_1: 0,
  tanggal_lahir_saudara_2: 0,
  tanggal_lahir_saudara_3: 0,
  telepon: "",
  tempat_lahir: "",
  tgl_lahir_kerabat_1: 0,
  tgl_lahir_kerabat_2: 0,
  tgl_lahir_kerabat_3: 0,
  tinggi_badan: 0,
  tingkat_lisan_bahasa_1: "",
  tingkat_lisan_bahasa_2: "",
  tingkat_membaca_bahasa_1: "",
  tingkat_membaca_bahasa_2: "",
  tingkat_mendengar_bahasa_1: "",
  tingkat_mendengar_bahasa_2: "",
  tingkat_menulis_bahasa_1: "",
  tingkat_menulis_bahasa_2: "",
  tipe_lulusan_pendidikan_1: "",
  tipe_lulusan_pendidikan_2: "",
  unit_kerja_kerabat_1: "",
  unit_kerja_kerabat_2: "",
  unit_kerja_kerabat_3: "",
  updated_at: 1746356665917,
  updated_by: 178566,
  uraian_jabatan_perusahaan_1: "",
  uraian_jabatan_perusahaan_2: "",
  user_data_id_text: "",
  user_id_text: "2BZ81hQ8a0aBYswl",
};

var mappingContent = [
  {
    column_reference: "nama_lengkap",
    company_id: 27414,
    content_label: "Nama Lengkap",
    created_at: 1746283298908,
    created_by: 178566,
    description: "",
    id: "rvpwl0xRxkhpCnKz",
    id_content: "rvpwl0xRxkhpCnKz",
    redaction_mapping_id: "hfqHUJGPDtoOBOaW",
    tag_reference: "TAG_NAMA_LENGKAP",
    updated_at: 1746283820261,
    updated_by: 178566,
  },
];

var dataReplaces = [];
var HTML_CONTENT = getDataRedaksi.konten;

function generateDataReplacements(
  getDataRedaksi,
  mappingContent,
  dataApplicant
) {
  var dataReplaces = [];

  if (
    getDataRedaksi &&
    getDataRedaksi.data_mapping &&
    Array.isArray(getDataRedaksi.data_mapping)
  ) {
    for (var i = 0; i < getDataRedaksi.data_mapping.length; i++) {
      var mapping = getDataRedaksi.data_mapping[i];
      if (mapping.data && mapping.data.id && mapping.data.name) {
        var contentMapping = null;
        for (var j = 0; j < mappingContent.length; j++) {
          if (mappingContent[j].id === mapping.data.id) {
            contentMapping = mappingContent[j];
            break;
          }
        }

        if (contentMapping) {
          var columnRef = contentMapping.column_reference;
          var tagRef = contentMapping.tag_reference;
          var replacementValue = dataApplicant[columnRef] || "";

          dataReplaces.push({
            string_before: tagRef,
            string_after: replacementValue,
          });
        }
      }
    }
  }

  return dataReplaces;
};

function replaceTagsInContent(htmlContent, dataReplaces) {
  var processedContent = htmlContent;

  for (var j = 0; j < dataReplaces.length; j++) {
    console.log(
      dataReplaces[j].string_before + " -> " + dataReplaces[j].string_after
    );
    processedContent = processedContent
      .split(dataReplaces[j].string_before)
      .join(dataReplaces[j].string_after);
  }

  return processedContent;
};

function processEmailTemplate(getDataRedaksi, mappingContent, dataApplicant) {
  var replacements = generateDataReplacements(
    getDataRedaksi,
    mappingContent,
    dataApplicant
  );

  for (var i = 0; i < replacements.length; i++) {
    var replacement = replacements[i];
    console.log(
      "Replacing " +
        replacement.string_before +
        " with " +
        replacement.string_after
    );
  }

  return {
    replacements: replacements,
  };
};

var dataReplaces = generateDataReplacements(getDataRedaksi,mappingContent,dataApplicant);
var HTML_CONTENT = getDataRedaksi.konten;
HTML_CONTENT = replaceTagsInContent(HTML_CONTENT, dataReplaces);
var emailData = processEmailTemplate(getDataRedaksi,mappingContent,dataApplicant);

console.log(HTML_CONTENT);
console.log(emailData);